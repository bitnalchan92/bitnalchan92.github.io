---
title: "[Express ê³µì‹ë¬¸ì„œ] 9. Guide(Overriding the Express API)"
description: "https://expressjs.com/en/guide/overriding-express-api.html"
date: 2024-09-25
categories: [express, ê³µì‹ê°€ì´ë“œ]
tags: [express guide, overriding api]
---



> [https://expressjs.com/en/guide/overriding-express-api.html](https://expressjs.com/en/guide/overriding-express-api.html)
{: .prompt-tip }



# Overriding the Express API

Express APIëŠ” ìš”ì²­ê³¼ ì‘ë‹µ ê°ì²´ì— ëŒ€í•œ ë‹¤ì–‘í•œ ë©”ì„œë“œì™€ ì†ì„±ë“¤ë¡œ êµ¬ì„±ë˜ì–´ìˆìŠµë‹ˆë‹¤. ì´ëŠ” í”„ë¡œí† íƒ€ì…ì— ì˜í•´ ìƒì†ë©ë‹ˆë‹¤. Express APIì—ëŠ” ë‘ê°€ì§€ í™•ì¥ í¬ì¸íŠ¸(extension points)ê°€ ìˆìŠµë‹ˆë‹¤. 



1. The global prototypes at `express.request` and `express.response`. ( `express.request` ë° `express.response`ì˜ ì „ì—­ í”„ë¡œí† íƒ€ì… )
2. App-specific prototypes at `app.request` and `app.response`. ( `app.request` ë° `app.response`ì˜ ì•±ë³„ í”„ë¡œí† íƒ€ì… )

ê¸€ë¡œë²Œ(ì „ì—­) í”„ë¡œí† íƒ€ì…ì„ ë³€ê²½í•˜ë©´ ë™ì¼í•œ í”„ë¡œì„¸ìŠ¤ì—ì„œ ë¡œë“œëœ ëª¨ë“  Expressì•±ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ì›í•˜ëŠ” ê²½ìš° ìƒˆ ì•±ì„ ë§Œë“  í›„ ì•±ë³„ë¡œ í”„ë¡œí† íƒ€ì…ë§Œ ë³€ê²½í•˜ì—¬ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 



> **í”„ë¡œí† íƒ€ì…?**
>
> - í”„ë¡œí† íƒ€ì…(prototype)ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì¤‘ìš”í•œ ê°œë…
> - **ë¹„ìœ : ì„¤ê³„ë„ì™€ ê±´ë¬¼**
>   - **ê°ì²´**ëŠ” ê±´ë¬¼ê³¼ ê°™ë‹¤. 
>   - **í”„ë¡œí† íƒ€ì…**ì€ ê·¸ ê±´ë¬¼ì„ ë§Œë“¤ê¸° ìœ„í•œ ì„¤ê³„ë„
> - ì¦‰, í”„ë¡œí† íƒ€ì…ì€ ê°ì²´ë“¤ì´ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì†ì„±ì´ë‚˜ ë©”ì„œë“œë¥¼ ì •ì˜í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ëª¨ë“  ê°ì²´ê°€ í”„ë¡œí† íƒ€ì…ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, í•´ë‹¹ ê°ì²´ê°€ í”„ë¡œí† íƒ€ì…ì— ì •ì˜ëœ ì†ì„±ì´ë‚˜ ë©”ì„œë“œë¥¼ ìƒì†ë°›ìŠµë‹ˆë‹¤.
>
> ```javascript
> function Person(name) {
>   this.name = name;
> }
> 
> Person.prototype.greet = function() {
>   console.log("Hello, " + this.name + "!");
> };
> 
> const alice = new Person("Alice");
> alice.greet(); // "Hello, Alice!"
> ```
>
> <br>
>
> **Express.jsì—ì„œì˜ í”„ë¡œí† íƒ€ì…**
>
> - Express.jsì—ì„œ `request`ì™€ `response` ê°ì²´ëŠ” í”„ë¡œí† íƒ€ì…ì„ í†µí•´ ë‹¤ì–‘í•œ ë©”ì„œë“œì™€ ì†ì„±ì„ ìƒì†ë°›ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ëª¨ë“  ìš”ì²­ ë° ì‘ë‹µ ê°ì²´ëŠ” ê³µí†µëœ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë©ë‹ˆë‹¤.
> - ì˜ˆë¥¼ ë“¤ì–´, ëª¨ë“  ìš”ì²­ ê°ì²´ëŠ” `req.params`, `req.query`, `req.body`ì™€ ê°™ì€ ì†ì„±ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ì´ëŠ” í”„ë¡œí† íƒ€ì…ì— ì •ì˜ëœ ê²ƒë“¤ì…ë‹ˆë‹¤.
> - ë”°ë¼ì„œ í”„ë¡œí† íƒ€ì…ì€ ê°ì²´ ê°„ì— ê³µí†µëœ ê¸°ëŠ¥ì„ ê³µìœ í•˜ê³  ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ì„¤ê³„ë„ë¼ê³  ì´í•´í•˜ë©´ ë©ë‹ˆë‹¤.
>
> <br>
>
> ì•„í•˜ğŸ˜ƒ



## <br>Methods

ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ë¥¼ í• ë‹¹í•˜ì—¬ ê¸°ì¡´ ë©”ì„œë“œì˜ signatureì™€ behavior(ì„œëª…ê³¼ ë™ì‘)ì„ ê°œë°œì ë³¸ì¸ì´ ì›í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ ì¬ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

> **signature**(ì„œëª…) : í•¨ìˆ˜ë‚˜ ë©”ì„œë“œì˜ ì´ë¦„ê³¼ í•´ë‹¹ í•¨ìˆ˜ë‚˜ ë©”ì„œë“œê°€ ì–´ë–¤ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ”ì§€ ë‚˜íƒ€ë‚´ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ê³ , ë³´í†µ 'í•¨ìˆ˜ ì´ë¦„', 'ë§¤ê°œë³€ìˆ˜ì˜ ìˆ˜ì™€ íƒ€ì…', 'ë°˜í™˜íƒ€ì…'ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ì ¸ìˆë‹¤.
>
> <br>**Expressì—ì„œ Signature(ì„œëª…)ì„ ë³€ê²½í•œë‹¤ëŠ” ê²ƒ...**
>
> ```javascript
> const express = require('express');
> const app = express();
> 
> // res.sendì˜ ì›ë˜ ì„œëª…
> app.use((req, res, next) => {
>   const originalSend = res.send;
>   res.send = function (body) {
>     console.log('Custom behavior!');
>     originalSend.call(this, body);
>   };
>   next();
> });
> 
> app.get('/', (req, res) => {
>   res.send('Hello World!');
> });
> 
> app.listen(3000, () => {
>   console.log('Server is running on port 3000');
> });
> ```
>
> ìœ„ ì½”ë“œì—ì„œ `res.send` ë©”ì„œë“œì˜ SignatureëŠ” ê·¸ëŒ€ë¡œ `res.send(body)`ë¡œ ìœ ì§€ë˜ì§€ë§Œ, ë™ì‘ì€ `console.log('Custom behavior!')`ë¥¼ ì¶”ê°€í•˜ì—¬ ì˜¤ë²„ë¼ì´ë“œ ë¬ë‹¤. ( ì¬ì •ì˜ ë˜ì—ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸ )



<br> ë‹¤ìŒì€ `res.sendStatus`ì˜ ë™ì‘ì„ overrideí•˜ëŠ” ì˜ˆì…ë‹ˆë‹¤. [res.sendStatus](https://expressjs.com/4x/api.html#res.sendStatus)

 ```javascript
 app.response.sendStatus = function (statusCode, type, message) {
   // code is intentionally kept simple for demonstration purpose
   return this.contentType(type)
   	.status(statusCode)
   	.send(message)
 }
 ```

ìœ„ì˜ êµ¬í˜„ì€ `res.sendStatus`ì˜ ì›ë˜ signatureì„ ì™„ì „íˆ ë³€ê²½í•©ë‹ˆë‹¤. ì´ì œ ìƒíƒœ ì½”ë“œ, ì¸ì½”ë”© ìœ í˜• ë° í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ë‚¼ ë©”ì„¸ì§€ë¥¼ ëª¨ë‘ í—ˆìš©í•©ë‹ˆë‹¤.

ì´ì œ ì¬ì •ì˜ëœ ë©”ì„œë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
res.sendStatus(404, 'application/json', '{"error":"resource not found"}')
```



## <br>Properties

Express APIì˜ ì†ì„±ì€ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.

1. Assigned properties ( ex: `req.baseUrl`, `req.originalUrl` ) ( í• ë‹¹ëœ ì†ì„±(ì˜ˆ: `req.baseUrl`, `req.originalUrl` ) )
2. Defined as getters ( ex: `req.secure`, `req.ip` ) ( getterë¡œ ì •ì˜ë¨(ì˜ˆ: `req.secure`, `req.ip` ) ) 



ì¹´í…Œê³ ë¦¬ 1ì˜ ì†ì„±ì€ í˜„ì¬ ìš”ì²­-ì‘ë‹µ ì£¼ê¸°ì˜ ë§¥ë½ì—ì„œ `request` ë° `response` ê°œì²´ì— ë™ì ìœ¼ë¡œ í• ë‹¹ë˜ë¯€ë¡œ í•´ë‹¹ ë™ì‘ì„ ì¬ì •ì˜í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.



ì¹´í…Œê³ ë¦¬ 2ì˜ ì†ì„±ì€ Express API í™•ì¥ APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.



<br>`req.ip`ì˜ ê°’ì„ ì–´ë–»ê²Œ ì–»ì„ì§€ë¥¼ ì¬ì •ì˜í•˜ëŠ” ì½”ë“œëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ IP ì£¼ì†Œë¥¼ íŠ¹ì • HTTP í—¤ë” ê°’ìœ¼ë¡œë¶€í„° ê°€ì ¸ì˜¤ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ `req.ip`ì˜ ê°’ì„ `Client-IP` ìš”ì²­ í—¤ë”ì˜ ê°’ìœ¼ë¡œ ì¬ì •ì˜í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

```javascript
/*
1. ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€ : app.useë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì‹¤í–‰ë  ë¯¸ë“¤ì›¨ì–´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
2. Object.defineProperty : req ê°ì²´ì˜ ip ì†ì„±ì„ ì¬ì •ì˜í•©ë‹ˆë‹¤.
  - get ë©”ì„œë“œë¥¼ ì •ì˜í•˜ì—¬ req.ipê°€ ì ‘ê·¼ë  ë•Œë§ˆë‹¤ Client-IP ìš”ì²­ í—¤ë”ì˜ ê°’ì„ ë°˜í™˜í•˜ë„ë¡ í•©ë‹ˆë‹¤.
3. next() í˜¸ì¶œ: ë¯¸ë“¤ì›¨ì–´ ì²´ì¸ì˜ ë‹¤ìŒ í•¨ìˆ˜ë¡œ ë„˜ì–´ê°€ê¸° ìœ„í•´ next()ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
4. ë£¨íŠ¸ í•¸ë“¤ëŸ¬ ì •ì˜: app.getì„ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ ê²½ë¡œ(/)ì— ëŒ€í•œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ res.sendë¥¼ ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ IPë¥¼ ì‘ë‹µìœ¼ë¡œ ë³´ëƒ…ë‹ˆë‹¤.
5. ì„œë²„ ì‹œì‘: app.listenì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ë¥¼ í¬íŠ¸ 3000ì—ì„œ ì‹œì‘í•©ë‹ˆë‹¤.

ì´ ì½”ë“œëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ Client-IP í—¤ë”ë¥¼ í†µí•´ IP ì£¼ì†Œë¥¼ ë³´ë‚¼ ë•Œ, req.ipê°€ í•´ë‹¹ í—¤ë”ì˜ ê°’ì„ ë°˜í™˜í•˜ë„ë¡ í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ req.ipì˜ ê¸°ë³¸ ë™ì‘ì„ ì¬ì •ì˜í•˜ì—¬ íŠ¹ì • ìš”êµ¬ì— ë§ê²Œ ì‚¬ìš©ì ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*/
const express = require('express');
const app = express();

// req.ipì˜ ê°’ì„ Client-IP ìš”ì²­ í—¤ë”ë¡œ ì¬ì •ì˜í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´
app.use((req, res, next) => {
  Object.defineProperty(req, 'ip', {
    get: function() {
      return req.headers['client-ip'];
    }
  });
  next();
});

app.get('/', (req, res) => {
  res.send(`Client IP is: ${req.ip}`);
});

app.listen(3000, () => {
  console.log('Server is running on port 3000');
});
```

```javascript
Object.defineProperty(app.request, 'ip', {
  configurable: true,
  enumerable: true,
  get () { return this.get('Client-IP') }
})
```



## <br>Prototype

Express APIë¥¼ ì œê³µí•˜ë ¤ë©´ (ì˜ˆë¥¼ ë“¤ì–´ `app(req, res)` ì„ í†µí•´) Expressì— ì „ë‹¬ëœ ìš”ì²­/ì‘ë‹µ ê°ì²´ê°€ ë™ì¼í•œ í”„ë¡œí† íƒ€ì… ì²´ì¸ì—ì„œ ìƒì†ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ì´ëŠ” ìš”ì²­ì˜ ê²½ìš° `http.IncomingRequest.prototype`ì´ê³  ì‘ë‹µì˜ ê²½ìš° `http.ServerResponse.prototype`ì…ë‹ˆë‹¤.

ê¼­ í•„ìš”í•œ ê²½ìš°ê°€ ì•„ë‹ˆë©´ ì „ì—­ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸°ë³´ë‹¤ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜ì¤€ì—ì„œë§Œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë˜í•œ ì‚¬ìš©ë˜ëŠ” í”„ë¡œí† íƒ€ì…ì´ ê¸°ë³¸ í”„ë¡œí† íƒ€ì…ê³¼ ê¸°ëŠ¥ì´ ìµœëŒ€í•œ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

```javascript
// Use FakeRequest and FakeResponse in place of http.IncomingRequest and http.ServerResponse
// for the given app reference
Object.setPrototypeOf(Object.getPrototypeOf(app.request), FakeRequest.prototype)
Object.setPrototypeOf(Object.getPrototypeOf(app.response), FakeResponse.prototype)
```

