---
title: "[Express ê³µì‹ë¬¸ì„œ] 7. Guide(Writing middleware for use in Express apps)"
description: "https://expressjs.com/en/guide/writing-middleware.html"
date: 2024-09-23
categories: [express]
tags: [express guide, routing]
---



> [https://expressjs.com/en/guide/writing-middleware.html](https://expressjs.com/en/guide/writing-middleware.html)
{: .prompt-tip }



# Writing middleware for use in Express apps (Express ì•±ì—ì„œ ì‚¬ìš©í•  ë¯¸ë“¤ì›¨ì–´ ì‘ì„±í•˜ê¸°)

## Overview

ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìš”ì²­-ì‘ë‹µ ì£¼ê¸°(cycle)ì—ì„œ [ìš”ì²­ê°ì²´](https://expressjs.com/en/4x/api.html#req)(`req`), [ì‘ë‹µê°ì²´](https://expressjs.com/en/4x/api.html#res)(`res`) ë° `next` í•¨ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. `next`í•¨ìˆ˜ëŠ” í˜„ì¬ ìˆ˜í–‰ì¤‘ì¸ ë¯¸ë“¤ì›¨ì–´ì˜ ë‹¤ìŒì— ì‹¤í–‰ë˜ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‹¤í–‰í•´ì•¼í• ë•Œ í˜¸ì¶œë˜ëŠ” Express routerë‚´ì˜ í•¨ìˆ˜ì…ë‹ˆë‹¤.

> next() í•¨ìˆ˜ê°€ ìµìˆ™í•˜ì§€ ì•Šì§€ë§Œ, ì˜ˆì œë¥¼ í†µí•´ ì´í•´í•´ë³´ê³ ì í•œë‹¤.



ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ëŠ” ë‹¤ìŒ ì‘ì—…ë“¤ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.



- Execute any code. (ëª¨ë“  ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.)
- Make changes to the request and the response objects. (ìš”ì²­ ë° ì‘ë‹µ ê°ì²´ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.)
- End the request-response cycle. (ìš”ì²­-ì‘ë‹µ ì£¼ê¸°ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.)
- Call the next middleware in the stack. (ìŠ¤íƒì˜ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.)



í˜„ì¬ ìˆ˜í–‰ì¤‘ì¸ ë¯¸ë“¤ì›¨ì–´ì˜ ê¸°ëŠ¥ì´ ìš”ì²­-ì‘ë‹µ ì£¼ê¸°ë¥¼ ì¢…ë£Œí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, `next()`ë¥¼ í˜¸ì¶œí•˜ì—¬ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ì—ê²Œ ì œì–´ê¶Œì„ ë„˜ê²¨ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ìš”ì²­ì´ ì¤‘ë‹¨ëœ ìƒíƒœë¡œ ìœ ì§€ë©ë‹ˆë‹¤. 

> Request-Response cycleì„ ì¢…ë£Œí•œë‹¤ëŠ” ê²ƒì€ res ì‘ë‹µê°ì²´ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì—ì„¸ ì˜¬ë°”ë¥¸ ì‘ë‹µì„ ë³´ë‚´ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ê³ , ì‚¬ìš©í•˜ëŠ” IDEì— ë”°ë¼ ë‹¤ë¥´ê² ì§€ë§Œ, ë‚´ê°€ ì‚¬ìš©í–ˆë˜ WebStormì—ì„œëŠ” ìœ„ì™€ ê°™ì´ next()ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì€ ê²½ìš° ì—ëŸ¬í‘œì‹œë¥¼ í•´ì¤¬ë˜ê±° ê°™ë‹¤. (ì´ê±´ ì•„ë‹ ìˆ˜ ìˆëŠ”ë° í™•ì¸í•´ë´ì•¼ í• ë“¯...). 
>
> ì•”íŠ¼ ì´ì „ ì˜ˆì œì—ì„œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì—¬ëŸ¬ê°œ ë¬¶ì–´ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë¥¼ ì‚´í´ë´¤ëŠ”ë°, ëª¨ë“  ìš”ì²­ì— ì‘ë‹µì´ í•„ìˆ˜ì ì´ë©°, ê°œë°œìê°€ ì´ì™€ ê°™ì´ ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ë¬¶ì–´ì„œ ìˆ˜í–‰í•˜ë„ë¡ í–ˆì„ë•Œ ì‘ë‹µí•˜ì§€ ì•ŠëŠ” ê²½ìš°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ ì—¬ê¸°ì—ì„  ê·¸ ë‚´ìš©ì„ ê°•ì¡°í•˜ê³  ìˆëŠ”ê±° ê°™ë‹¤.



ë‹¤ìŒ ê·¸ë¦¼ì€ ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ í˜¸ì¶œì˜ ìš”ì†Œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. 

![image-20240923135522890](../assets/img/image-20240923135522890.png)

> ìœ„ì—ì„œë¶€í„°... 
>
> 1. ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ê°€ ì ìš©ë˜ëŠ” HTTP METHODì…ë‹ˆë‹¤. (ì—¬ê¸°ì„  get)
> 2. ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ê°€ ì ì˜ë˜ëŠ” path(ê²½ë¡œ)ì…ë‹ˆë‹¤.
> 3. ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜...
> 4. `next`ë¼ê³  ë¶ˆë¦¬ìš°ëŠ” ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ì— ëŒ€í•œ ì½œë°± ì¸ìì…ë‹ˆë‹¤.
> 5. `res`ë¼ê³  ë¶ˆë¦¬ëŠ” ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ì— ëŒ€í•œ HTTP ì‘ë‹µ ì¸ìì…ë‹ˆë‹¤.
> 6. `req`ë¼ê³  í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ì— ëŒ€í•œ HTTP ìš”ì²­ ì¸ìì…ë‹ˆë‹¤.



Express 5 ë¶€í„°ëŠ” `Promise`ë¥¼ ë°˜í™˜í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ê°€ ê±°ë¶€ë˜ê±°ë‚˜ ì˜¤ë¥˜ë¥¼ ë˜ì§ˆë•Œ next(value)ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. `next`ëŠ” ê±°ë¶€ëœ ê°’ì´ë‚˜ ë˜ì§„ ì˜¤ë¥˜ë¥¼ ì¸ìë¡œ í•˜ì—¬ í˜¸ì¶œë©ë‹ˆë‹¤. 

> next()ê°€ ì½œë°±í•¨ìˆ˜ì´ê¸° ë•Œë¬¸ì—, ìœ„ì˜ ì„¤ëª…ì²˜ëŸ¼ ê°’ ë˜ëŠ” ì˜¤ë¥˜ë¥¼ ì¸ìë¡œ ê°€ì§€ê³  í˜¸ì¶œëœë‹¤. 



## Example

ë‹¤ìŒì€ ê°„ë‹¨í•œ "Hello World" Express ì˜ˆì œì…ë‹ˆë‹¤. ì´ í¬ìŠ¤íŒ…ì˜ ë‚˜ë¨¸ì§€ ë‚´ìš©ì—ì„œëŠ” ì„¸ ê°€ì§€ ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì¶”ê°€í•©ë‹ˆë‹¤. í•˜ë‚˜ëŠ” ê°„ë‹¨í•œ ë¡œê·¸ ë©”ì„¸ì§€ë¥¼ printí•˜ëŠ” `myLogger`, ë˜ í•˜ë‚˜ëŠ” HTTPìš”ì²­ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ í‘œì‹œí•˜ëŠ” `requestTime`, ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ í•˜ë‚˜ëŠ” ìˆ˜ì‹  ì¿ í‚¤ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” `validateCookies`ë¼ëŠ” ê²ƒì…ë‹ˆë‹¤.

```javascript
const express = require('express')
const app = express()

app.get('/', (req, res) => {
  res.send('Hello World!')
})

app.listen(3000)
```



## Middleware function `myLogger`

ë‹¤ìŒì€ "myLogger"ë¼ëŠ” ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ì˜ ê°„ë‹¨í•œ ì˜ˆì œì…ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” ì•±ì— ëŒ€í•œ Requestê°€ ìˆì„ë•Œ "LOGGED"ë¥¼ ì¶œë ¥í•©ë‹ˆë‹¤. ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ëŠ” `myLogger`ë¼ëŠ” ë³€ìˆ˜ì— í• ë‹¹ë©ë‹ˆë‹¤. 

```javascript
const myLogger = function (req, res, next) {
  console.log('LOGGED')
  next()
}
```



>ìœ„ì˜ `next()` í˜¸ì¶œì„ í™•ì¸í•˜ì„¸ìš”. ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ì•±ì—ì„œ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
>
> `next()` í•¨ìˆ˜ëŠ” Node.js ë˜ëŠ” Express APIì˜ ì¼ë¶€ê°€ ì•„ë‹ˆì§€ë§Œ **ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ” ì„¸ ë²ˆì§¸ ì¸ìˆ˜(ì¸ì)**ì…ë‹ˆë‹¤.
>
> `next()` í•¨ìˆ˜ì˜ ì´ë¦„ì€ ë¬´ì—‡ì´ë“  ì§€ì •í•  ìˆ˜ ìˆì§€ë§Œ ê´€ë¡€ìƒ í•­ìƒ "next"ë¼ëŠ” ì´ë¦„ì´ ì§€ì •ë©ë‹ˆë‹¤. í˜¼ë€ì„ í”¼í•˜ê¸° ìœ„í•´ í•­ìƒ ì´ ê·œì¹™ì„ ì‚¬ìš©í•˜ì‹­ì‹œì˜¤.



ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ë¥¼ ë¡œë“œí•˜ë ¤ë©´ `app.use()`ì„ í˜¸ì¶œí•˜ì—¬ ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ë¥¼ ì§€ì •í•˜ë©´ ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ë‹¤ìŒ ì½”ë“œëŠ” ë£¨íŠ¸ ê²½ë¡œ(`/`)ì— ëŒ€í•œ ê²½ë¡œ ì•ì— `myLogger` ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.

```javascript
const express = require('express')
const app = express()

const myLogger = function (req, res, next) {
  console.log('LOGGED')
  next()
}

app.use(myLogger)

app.get('/', (req, res) => {
  res.send('Hello World!')
})

app.listen(3000)
```

1. ì•±ì€ ìš”ì²­ì„ ë°›ì„ë•Œë§ˆë‹¤, "LOGGED" ë©”ì„¸ì§€ë¥¼ í„°ë¯¸ë„(ì½˜ì†”)ì— ì¶œë ¥í•©ë‹ˆë‹¤. 
   - `app.use()`ì—ì„œ ëª¨ë“ˆì„ ì—°ê²°í–ˆê¸°ë•Œë¬¸ì—, expressì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ appì— ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  Requestì˜ ìš”ì²­ì— ëŒ€í•´ì„œ myLogger ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ê°€ ìˆ˜í–‰ë©ë‹ˆë‹¤. 
2. ë¯¸ë“¤ì›¨ì–´ì˜ ë¡œë”© ìˆœì„œë„ ì¤‘ìš”í•©ë‹ˆë‹¤. **ë¨¼ì €** ë¡œë“œëœ ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ê°€ ë¨¼ì € ì‹¤í–‰ë©ë‹ˆë‹¤.
3. ë§Œì•½ `myLogger`ê°€ ë£¨íŠ¸ ê²½ë¡œ(`/`)ì˜ ë¼ìš°íŠ¸ë³´ë‹¤ ë‚˜ì¤‘ì— ë¡œë“œê°€ ëœë‹¤ë©´ ìš”ì²­ì´ ë£¨íŠ¸ ê²½ë¡œì— ë„ë‹¬í•˜ì§€ ì•Šê³ , ë˜í•œ ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì•±ì´ "LOGGED"ë„ ì¶œë ¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¦¬ëŠ” ë£¨íŠ¸ ê²½ë¡œì˜ Route Handlerê°€ ìš”ì²­-ì‘ë‹µ ì£¼ê¸°ë¥¼ ì¢…ë£Œí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```javascript
// ğŸ¤— GPTê°€ ì•Œë ¤ì¤€ ì˜ˆì œ
// ì•„ë˜ ì—ì„œëŠ” `/`ê°€ ë¨¼ì € ì •ì˜ë˜ì—ˆê³ , ê·¸ ì´í›„ì— myLogger ë¯¸ë“¤ì›¨ì–´ê°€ ë¡œë“œëœë‹¤. 
// ì´ ê²½ìš°, ìš”ì²­ì´ `/`ì— ë„ë‹¬í•˜ë©´, í•´ë‹¹ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì‘ë‹µì„ ë³´ë‚´ë©´ì„œ ìš”ì²­-ì‘ë‹µ ì£¼ê¸°ë¥¼ ì¢…ë£Œí•˜ê³  ë”°ë¼ì„œ myLogger ë¯¸ë“¤ì›¨ì–´ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤. 
const express = require('express');
const app = express();

// ë£¨íŠ¸ ê²½ë¡œì— ëŒ€í•œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬
app.get('/', (req, res) => {
  res.send('Hello, World!');
});

// ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜
const myLogger = (req, res, next) => {
  console.log('LOGGED');
  next();
};

// myLogger ë¯¸ë“¤ì›¨ì–´ ë¡œë“œ
app.use(myLogger);

// ì„œë²„ ì‹œì‘
app.listen(3000, () => {
  console.log('Server is running on port 3000');
});


// =====================================================
// myLoggerë¥¼ ì›ë˜ì˜ ëª©ì ëŒ€ë¡œ ì‚¬ìš©í•˜ë ¤ë©´ ë¨¼ì € ë¡œë“œí•´ì•¼í•œë‹¤. 
const express = require('express');
const app = express();

// ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜
const myLogger = (req, res, next) => {
  console.log('LOGGED');
  next();
};

// myLogger ë¯¸ë“¤ì›¨ì–´ ë¡œë“œ
app.use(myLogger);

// ë£¨íŠ¸ ê²½ë¡œì— ëŒ€í•œ ë¼ìš°íŠ¸ í•¸ë“¤ëŸ¬
app.get('/', (req, res) => {
  res.send('Hello, World!');
});

// ì„œë²„ ì‹œì‘
app.listen(3000, () => {
  console.log('Server is running on port 3000');
});
```



ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ `myLogger`ëŠ” ë‹¨ìˆœíˆ ë©”ì„¸ì§€ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•œ í›„ `next()`í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ìŠ¤íƒì— ì¡´ì¬í•˜ëŠ” ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ì—ê²Œ ìš”ì²­ì„ ì „ë‹¬í•©ë‹ˆë‹¤.



## Middleware function requestTime

ë‹¤ìŒìœ¼ë¡œ "requestTime"ì´ë¼ëŠ” ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ë¥¼ ë§Œë“¤ê³  `requestTime`ì´ë¼ëŠ” ì†ì„±ì„ ìš”ì²­ ê°ì²´ì— ì¶”ê°€í•©ë‹ˆë‹¤.

```javascript
const requestTime = function (req, res, next) {
  req.requestTime = Date.now()
  next()
}
```



ì´ì œ `requestTime` ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ì‹œê°„ ì •ë³´ë¥¼ ì¶”ê°€í•˜ê³ , ë£¨íŠ¸ ê²½ë¡œì˜ ì½œë°± í•¨ìˆ˜ì—ì„œ ì´ ì •ë³´ë¥¼ í™œìš©í•˜ë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ `requestTime` ë¯¸ë“¤ì›¨ì–´ë¥¼ ì •ì˜í•˜ê³ , ë£¨íŠ¸ ê²½ë¡œì˜ ì½œë°± í•¨ìˆ˜ì—ì„œ `req` ê°ì²´ì— ì¶”ê°€ëœ ì†ì„±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
const express = require('express')
const app = express()

const requestTime = function (req, res, next) {
  req.requestTime = Date.now()
  next()
}

app.use(requestTime)

app.get('/', (req, res) => {
  let responseText = 'Hello World!<br>'
  
  // âœ¨ ì„ í–‰ëœ requestTime middlewareì—ì„œ reqê°ì²´ì— requestTimeì„ ì…‹íŒ…í•´ë†¨ê¸° ë•Œë¬¸ì—, ì´ì™€ ê°™ì´ í•´ë‹¹ ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  responseText += `<small>Requested at: ${req.requestTime}</small>`
  res.send(responseText)
})

app.listen(3000)
```

ì•± ë£¨íŠ¸ì— ìš”ì²­í•˜ë©´ ì•±ì€ ì´ì œ ë¸Œë¼ìš°ì €ì— ìš”ì²­ì´ ë“¤ì–´ì˜¨ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ í‘œì‹œí•˜ê²Œ ë©ë‹ˆë‹¤. 



## Middleware function validateCookies

ë§ˆì§€ë§‰ìœ¼ë¡œ, ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì˜ ì¿ í‚¤ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ê³  ì¿ í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° 400 ì‘ë‹µì„ ë³´ë‚´ëŠ” ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ë´…ì‹œë‹¤. 



ë‹¤ìŒì€ ì™¸ë¶€ì˜ ë¹„ë™ê¸° ì„œë¹„ìŠ¤ë¡œ ì¿ í‚¤ì˜ ìœ íš¨ì„±ì„ ê²€ì‚¬í•˜ëŠ” í•¨ìˆ˜ì˜ ì˜ˆì…ë‹ˆë‹¤.

```javascript	
async function cookieValidator (cookies) {
  try {
    await externallyValidateCookie(cookies.testCookie)
  } catch {
    throw new Error('Invalid cookies')
  }
}
```



`cookie-parser` ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë“¤ì–´ì˜¤ëŠ” ì¿ í‚¤ë¥¼ íŒŒì‹±í•˜ê³ , ì´ë¥¼ `cookieValidator` í•¨ìˆ˜ì— ì „ë‹¬í•˜ëŠ” ì˜ˆì œë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤. `validateCookies` ë¯¸ë“¤ì›¨ì–´ëŠ” Promiseë¥¼ ë°˜í™˜í•˜ë©°, ì´ Promiseê°€ ê±°ë¶€ë˜ë©´ ìë™ìœ¼ë¡œ ì˜¤ë¥˜ í•¸ë“¤ëŸ¬ë¥¼ í˜¸ì¶œí•˜ë„ë¡ í•©ë‹ˆë‹¤.



```javascript
const express = require('express')
const cookieParser = require('cookie-parser')
const cookieValidator = require('./cookieValidator')

const app = express()

// validateCookies middleware ì‘ì„±
async function validateCookies (req, res, next) {
  await cookieValidator(req.cookies)
  next()
}

// cookie-parser ë¯¸ë“¤ì›¨ì–´ ë¡œë“œ
app.use(cookieParser())

// validateCookiew ë¯¸ë“¤ì›¨ì–´ ë¡œë“œ
app.use(validateCookies)

// error handler
app.use((err, req, res, next) => {
  res.status(400).send(err.message)
})

app.listen(3000)
```



>  `validateCookies` ë¯¸ë“¤ì›¨ì–´ì—ì„œ `next()` í•¨ìˆ˜ê°€ `await cookieValidator(req.cookies)` ë’¤ì— í˜¸ì¶œë˜ëŠ” ë°©ì‹ì„ ì„¤ëª…í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ `cookieValidator`ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ìŠ¤íƒì˜ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ê°€ í˜¸ì¶œë©ë‹ˆë‹¤. ë§Œì•½ `next()` í•¨ìˆ˜ì— ë¬¸ìì—´ 'route'ë‚˜ 'router'ê°€ ì•„ë‹Œ ë‹¤ë¥¸ ê°’ì„ ì „ë‹¬í•˜ë©´, ExpressëŠ” í˜„ì¬ ìš”ì²­ì„ ì˜¤ë¥˜ë¡œ ê°„ì£¼í•˜ê³  ë‚¨ì•„ ìˆëŠ” ëª¨ë“  ë¹„ì˜¤ë¥˜ ì²˜ë¦¬ ë¼ìš°íŒ… ë° ë¯¸ë“¤ì›¨ì–´ í•¨ìˆ˜ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.



ìš”ì²­ ê°ì²´, ì‘ë‹µ ê°ì²´, ìŠ¤íƒì˜ ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ ê¸°ëŠ¥ ë° ì „ì²´ Node.js APIì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¯¸ë“¤ì›¨ì–´ ê¸°ëŠ¥ì˜ ê°€ëŠ¥ì„±ì€ ë¬´ê¶ë¬´ì§„í•©ë‹ˆë‹¤.



Express ë¯¸ë“¤ì›¨ì–´ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ Express ë¯¸ë“¤ì›¨ì–´ ì‚¬ìš©ì„ ì°¸ì¡°í•˜ì„¸ìš”. [Using Express middleware](https://expressjs.com/en/guide/using-middleware.html).



## Configurable middleware

ë¯¸ë“¤ì›¨ì–´ë¥¼ êµ¬ì„± ê°€ëŠ¥í•˜ê²Œ í•´ì•¼í•˜ëŠ” ê²½ìš° ì˜µì…˜ ê°ì²´ë‚˜ ê¸°íƒ€ ë§¤ê°œë³€ìˆ˜ë¥¼ í—ˆìš©í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë‚´ë³´ë‚¸ ë‹¤ìŒ ì…ë ¥ ë§¤ê°œë³€ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„ì„ ë°˜í™˜í•©ë‹ˆë‹¤. 

File : `my-middleware.js`

```javascript
module.exports = function(options) {
  return function (req, res, next) {
    // Implement the middleware function based on the options object
    next()
  }
}
```



ì´ì œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

```javascript
const myMiddleware = requird('./my-middleware.js')

app.use(myMiddleware({option1: '1', option2: '2'}))
```



êµ¬ì„±ê°€ëŠ¥í•œ ë¯¸ë“¤ì›¨ì–´ì˜ ì˜ˆì œëŠ” [cookie-session](https://github.com/expressjs/cookie-session) ê³¼ [compression](https://github.com/expressjs/compression) ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”!
